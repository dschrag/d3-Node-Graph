<!DOCTYPE html>
<html><head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Issue Node Graph</title>
<script src="d3.min.js"></script>
<script src="d3.rollup.v0.min.js"></script>

</head>
<style>
#tooltip {
        position: absolute;
        width: 150px;
        height: auto;
        padding: 5px;
        background-color: white;
		opacity: 0.8;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        -webkit-box-shadow: 4px 4px 5px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 5px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 5px rgba(0, 0, 0, 0.4);
        pointer-events: none;
}

#tooltip.hidden {
        display: none;
}

#tooltip p {
        margin: 0;
        font-family: sans-serif;
        font-size: 12px;
        line-height: 16px;
}

.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}


</style>

<body>
<div id="tooltip" class="hidden">
        <p><strong>Player Detail</strong></p>
        <p>Name: <span id="name">100</span></p>
		<p>Number: <span id="number">100</span></p>
		<p>Position: <span id="pos">100</span></p>
		<p>X: <span id="x">100</span></p>
		<p>Y: <span id="y">100</span></p>
</div>
	<script>
  	var scaleh = d3.scale.linear();
	var scalev = d3.scale.linear();
	var width = 800,
	height = 800;
	
	function fx(d) { return d.x; };
	function fy(d) { return d.y; };
	
	var rollup = d3.rollup()
    .x(function(d) { return fx(d); })
    .y(function(d) { return fy(d); });

	
d3.xml("field.svg", function(xml) {
	svgdom = document.body.appendChild(xml.documentElement);

  	var svg = d3.select("svg");
	var defs = d3.select("defs");

	scaleh.domain([0, height]);
	scaleh.range([0, 800]);
	scalev.domain([0, width]);
	scalev.range([0, 800]);
  

d3.json("coords.json", function(json) {

	datap = json.nodes;

	/*var datap_start = datap.filter( function (el){
		return el.Status == "starting"; });

	json.nodes = datap_start;*/
	var graph = rollup(json);		
	var done = 0;
	var speed = 200;
	var count = graph.links.length;
	
	var link = svg.selectAll(".link")
		.data(graph.links)
		.enter().append("g")
		.attr("class", "linkg");
		
	svg.selectAll(".linkg")
		.data(graph.links)
		.append("path")
		.attr("class", function(d) {
			return "link " + "from" + d.source.nodes[0].Number + " to" + d.target.nodes[0].Number;
		  })
		.attr("id" ,function(d) {
			return "link" + "from" + d.source.nodes[0].Number + "to" + d.target.nodes[0].Number;
		  })	  
		.attr("d", function(d) {
			var sx = d.source.x, sy = d.source.y,
			tx = d.target.x, ty = d.target.y,
			dx = tx - sx, dy = ty - sy,
			dr = 2 * Math.sqrt(dx * dx + dy * dy);
			return "M" + sx + "," + sy + "A" + dr + "," + dr + " 0 0,1 " + tx + "," + ty;
		  })
		.style("stroke", "yellow")
		.style("stroke-width", function(d) { 
			return d.value * 2; 
		  })
		.attr("stroke-dasharray", 1000)
		.attr("stroke-dashoffset", 1000)
		.transition()
			.duration(function(d, i) { 
				console.log(d);
				return graph.links[i].links[0].speed; 
			})
			.ease("linear")
			.attr("stroke-dashoffset", 0)
			.delay(function(d, i) { 
				return graph.links[i].links[0].speed; 
			})
		.style("stroke", "grey")
		.each("end", myCallback);
	console.log(graph.nodes);
	 
	function myCallback() {
		done++;
	}
	var node = svg.selectAll(".node")
		.data(graph.nodes)
		.enter().append("g")
		.attr("class", "node")
		.style("pointer-events", "all")
		.append("circle")
		.attr("cx", function(d, i){ return d.x})
		.attr("cy", function(d, i){ return d.y})
		.attr("r", 10)
		.attr("filter","url(#f3)")
		.style("fill", "white")
		.style("stroke", "grey")
		.style("stroke-width", "1");
	
	svg.selectAll(".node")
			.data(graph.nodes)
			.append("text")
		   .text(function(d, i) {   
				return d.nodes[0].Number;
		   })
		   .attr("x", function(d, i) {
				return d.x;
		   })
		   .attr("y", function(d, i) {
				return d.y ;
		   })
		   .style("font-family", "sans-serif")
		   .style("font-size", "11px")
		   .style("text-anchor", "middle")
		   .style("dominant-baseline", "central")
		   .style("stroke", "black")
		   .style("pointer-events", "none");
		 
		 svg.selectAll("textpaths")
			.data(graph.links)
			.enter()
			.append("text")			
			.style("font-size", "12px")
			.attr("class", "texts")
			.attr("x", "0")
			.attr("y", "0")
			.append("textPath")
			.attr("class", function(d) {
				return "pathlabel " + "from" + d.source.nodes[0].Number + " to" + d.target.nodes[0].Number;
			})
			.attr("xlink:href", function(d) { 
				return '#' + "link" + "from" + d.source.nodes[0].Number + "to" + d.target.nodes[0].Number 
			})
			.text(function(d) { 
				return d.value;
			})
			.attr("startOffset", "40%")
			.style("stroke", "black")
			.attr("filter","url(#f3)")
			.style("fill", "white")
			.style("font-family", "sans-serif")	
			.style("display", "none");
		
	if (true) {
		
		node = svg.selectAll(".node")
		.on("mouseover", function(d) {

			var xPosition = scaleh(parseFloat(d3.select(this).attr("cx")));
			var yPosition = scalev(parseFloat(d3.select(this).attr("cy")));

			d3.selectAll(".to" + d.nodes[0].Number + ":not(.pathlabel)")
			.transition()
			.duration(10)
			.style("stroke", "orange")
			.style("display", "block")
			.style("stroke-opacity", ".7")
			;
			
			d3.selectAll(".from" + d.nodes[0].Number + ":not(.pathlabel)")
			.transition()
			.duration(10)
			.style("stroke", "blue")
			.style("display", "block")
			.style("stroke-opacity", ".7")
			;

			d3.selectAll(".pathlabel.to" + d.nodes[0].Number)
			.style("fill", "orange")
			.style("stroke", "white")
			.style("display", "block");
			
			d3.selectAll(".pathlabel.from" + d.nodes[0].Number)
			.style("fill", "blue")
			.style("stroke", "white")
			.style("display", "block");
			
			d3.select(this).style("fill", "LightGoldenRodYellow");

			d3.select("#tooltip")
			  .style("left", xPosition + "px")
			  .style("top", yPosition + "px")
			  .select("#name")
			  .text(d.nodes[0].name);
			 
			d3.select("#tooltip") 
			  .select("#number")
			  .text(d.nodes[0].Number);

			  d3.select("#tooltip")
			  .select("#pos")
			  .text(d.nodes[0].Position);
			
			d3.select("#tooltip")
			  .select("#x")
			  .text(xPosition);
			d3.select("#tooltip")
			  .select("#y")
			  .text(yPosition);

			d3.select("#tooltip").classed("hidden", false);
			   
		})
		.on("mouseout", function(d) {

			d3.selectAll(".to" + d.nodes[0].Number + ":not(.pathlabel)")
			.style("stroke", "grey")
			.style("stroke-opacity", ".2");

			d3.selectAll(".from" + d.nodes[0].Number + ":not(.pathlabel)")
			.style("stroke", "grey")
			.style("stroke-opacity", ".2");
			
			d3.selectAll(".pathlabel")
			.style("fill", "grey")
			.style("display", "none");

			d3.select("#tooltip").classed("hidden", true);
			d3.select(this).style("fill", "white");
		});
	
	}
});
});

</script>
	</body>
</html>
 
 